// svg.draggable.js 0.1.0 - Copyright (c) 2014 Wout Fierens - Licensed under the MIT license
(function(){SVG.extend(SVG.Element,{draggable:function(constraint){var start,drag,end,element=this,parent=this.parent._parent(SVG.Nested)||this._parent(SVG.Doc);if(typeof this.fixed==="function")this.fixed();constraint=constraint||{};start=function(event){event=event||window.event;if(element.beforedrag)element.beforedrag(event);var box=element.bbox();if(element instanceof SVG.G){box.x=element.x();box.y=element.y()}else if(element instanceof SVG.Nested){box={x:element.x(),y:element.y(),width:element.width(),height:element.height()}}element.startEvent=event;element.startPosition={x:box.x,y:box.y,width:box.width,height:box.height,zoom:parent.viewbox().zoom,rotation:element.transform("rotation")*Math.PI/180};SVG.on(window,"mousemove",drag);SVG.on(window,"touchmove",drag);SVG.on(window,"mouseup",end);SVG.on(window,"touchend",end);if(element.dragstart)element.dragstart({x:0,y:0,zoom:element.startPosition.zoom},event);event.preventDefault?event.preventDefault():event.returnValue=false};drag=function(event){event=event||window.event;if(element.startEvent){var x,y,rotation=element.startPosition.rotation,width=element.startPosition.width,height=element.startPosition.height,delta={};if(event.type=="touchstart"||event.type=="touchmove"){if(window.navigator.userAgent.match(/iPad/i)){delta={x:event.touches[0].pageX-element.startEvent.pageX,y:event.touches[0].pageY-element.startEvent.pageY,zoom:element.startPosition.zoom}}else{delta={x:event.touches[0].pageX-element.startEvent.touches[0].pageX,y:event.touches[0].pageY-element.startEvent.touches[0].pageY,zoom:element.startPosition.zoom}}}else if(event.type=="click"||event.type=="mousedown"||event.type=="mousemove"){delta={x:event.pageX-element.startEvent.pageX,y:event.pageY-element.startEvent.pageY,zoom:element.startPosition.zoom}}else{delta={x:event.pageX-element.startEvent.pageX,y:event.pageY-element.startEvent.pageY,zoom:element.startPosition.zoom}}x=element.startPosition.x+(delta.x*Math.cos(rotation)+delta.y*Math.sin(rotation))/element.startPosition.zoom;y=element.startPosition.y+(delta.y*Math.cos(rotation)+delta.x*Math.sin(-rotation))/element.startPosition.zoom;if(typeof constraint==="function"){var coord=constraint(x,y);if(typeof coord==="object"){if(typeof coord.x!="boolean"||coord.x)element.x(typeof coord.x==="number"?coord.x:x);if(typeof coord.y!="boolean"||coord.y)element.y(typeof coord.y==="number"?coord.y:y)}else if(typeof coord==="boolean"&&coord){element.move(x,y)}}else if(typeof constraint==="object"){if(constraint.minX!=null&&x<constraint.minX)x=constraint.minX;else if(constraint.maxX!=null&&x>constraint.maxX-width)x=constraint.maxX-width;if(constraint.minY!=null&&y<constraint.minY)y=constraint.minY;else if(constraint.maxY!=null&&y>constraint.maxY-height)y=constraint.maxY-height;element.move(x,y)}if(element.dragmove)element.dragmove(delta,event)}};end=function(event){event=event||window.event;var delta={};if(event.type=="touchstart"||event.type=="touchmove"){if(window.navigator.userAgent.match(/iPad/i)){delta={x:event.touches[0].pageX-element.startEvent.pageX,y:event.touches[0].pageY-element.startEvent.pageY,zoom:element.startPosition.zoom}}else{delta={x:event.touches[0].pageX-element.startEvent.touches[0].pageX,y:event.touches[0].pageY-element.startEvent.touches[0].pageY,zoom:element.startPosition.zoom}}}else if(event.type=="click"||event.type=="mousedown"||event.type=="mousemove"){delta={x:event.pageX-element.startEvent.pageX,y:event.pageY-element.startEvent.pageY,zoom:element.startPosition.zoom}}else{delta={x:event.pageX-element.startEvent.pageX,y:event.pageY-element.startEvent.pageY,zoom:element.startPosition.zoom}}element.startEvent=null;element.startPosition=null;SVG.off(window,"mousemove",drag);SVG.off(window,"touchmove",drag);SVG.off(window,"mouseup",end);SVG.off(window,"touchend",end);if(element.dragend)element.dragend(delta,event)};element.on("mousedown",start);element.on("touchstart",start);element.fixed=function(){element.off("mousedown",start);element.off("touchstart",start);SVG.off(window,"mousemove",drag);SVG.off(window,"touchmove",drag);SVG.off(window,"mouseup",end);SVG.off(window,"touchend",end);start=drag=end=null;return element};return this}})}).call(this);