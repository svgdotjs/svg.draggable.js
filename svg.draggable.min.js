// svg.draggable.js 0.1.0 - Copyright (c) 2014 Wout Fierens - Licensed under the MIT license
(function(){SVG.extend(SVG.Element,{draggable:function(t){var o,e,i,n=this;if(typeof this.fixed==="function")this.fixed();t=t||{};o=function(t){var o=this.parent._parent(SVG.Nested)||this._parent(SVG.Doc);t=t||window.event;if(n.beforedrag)n.beforedrag(t);var a=n.bbox();if(n instanceof SVG.G){a.x=n.x();a.y=n.y()}else if(n instanceof SVG.Nested){a={x:n.x(),y:n.y(),width:n.width(),height:n.height()}}n.startEvent=t;n.startPosition={x:a.x,y:a.y,width:a.width,height:a.height,zoom:o.viewbox().zoom,rotation:n.transform("rotation")*Math.PI/180};SVG.on(window,"mousemove",e);SVG.on(window,"mouseup",i);if(n.dragstart)n.dragstart({x:0,y:0,zoom:n.startPosition.zoom},t);t.preventDefault?t.preventDefault():t.returnValue=false};e=function(o){o=o||window.event;if(n.startEvent){var e,i,a=n.startPosition.rotation,s=n.startPosition.width,f=n.startPosition.height,r={x:o.pageX-n.startEvent.pageX,y:o.pageY-n.startEvent.pageY,zoom:n.startPosition.zoom};e=n.startPosition.x+(r.x*Math.cos(a)+r.y*Math.sin(a))/n.startPosition.zoom;i=n.startPosition.y+(r.y*Math.cos(a)+r.x*Math.sin(-a))/n.startPosition.zoom;if(typeof t==="function"){var m=t(e,i);if(typeof m==="object"){if(typeof m.x!="boolean"||m.x)n.x(typeof m.x==="number"?m.x:e);if(typeof m.y!="boolean"||m.y)n.y(typeof m.y==="number"?m.y:i)}else if(typeof m==="boolean"&&m){n.move(e,i)}}else if(typeof t==="object"){if(t.minX!=null&&e<t.minX)e=t.minX;else if(t.maxX!=null&&e>t.maxX-s)e=t.maxX-s;if(t.minY!=null&&i<t.minY)i=t.minY;else if(t.maxY!=null&&i>t.maxY-f)i=t.maxY-f;n.move(e,i)}if(n.dragmove)n.dragmove(r,o)}};i=function(t){t=t||window.event;var o={x:t.pageX-n.startEvent.pageX,y:t.pageY-n.startEvent.pageY,zoom:n.startPosition.zoom};n.startEvent=null;n.startPosition=null;SVG.off(window,"mousemove",e);SVG.off(window,"mouseup",i);if(n.dragend)n.dragend(o,t)};n.on("mousedown",o);n.fixed=function(){n.off("mousedown",o);SVG.off(window,"mousemove",e);SVG.off(window,"mouseup",i);o=e=i=null;return n};return this}})}).call(this);